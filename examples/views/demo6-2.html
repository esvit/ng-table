<div class="page-header">
    <h1>Summary</h1>
</div>

<script data-run-script>
    window.DemoCtrl = function($scope, $filter, ngTableParams) {
        var data = [{name: "Moroni", age: 50, role: 'Administrator'},
            {name: "Tiancum", age: 43, role: 'Administrator'},
            {name: "Jacob", age: 27, role: 'Administrator'},
            {name: "Nephi", age: 29, role: 'Moderator'},
            {name: "Enos", age: 34, role: 'User'},
            {name: "Tiancum", age: 43, role: 'User'},
            {name: "Jacob", age: 27, role: 'User'},
            {name: "Nephi", age: 29, role: 'Moderator'},
            {name: "Enos", age: 34, role: 'User'},
            {name: "Tiancum", age: 43, role: 'Moderator'},
            {name: "Jacob", age: 27, role: 'User'},
            {name: "Nephi", age: 29, role: 'User'},
            {name: "Enos", age: 34, role: 'Moderator'},
            {name: "Tiancum", age: 43, role: 'User'},
            {name: "Jacob", age: 27, role: 'User'},
            {name: "Nephi", age: 29, role: 'User'},
            {name: "Enos", age: 34, role: 'User'}];

        $scope.tableParams = new ngTableParams({
            page: 1,            // show first page
            count: 10          // count per page
        }, {
            groupBy: 'role',
            total: data.length,
            getData: function($defer, params) {
                var orderedData = params.sorting() ?
                        $filter('orderBy')(data, $scope.tableParams.orderBy()) :
                        data;

                $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));
            }
        });

        $scope.calcSum = function(data) {
            var sum = 0;
            angular.forEach(data, function(item) {
                sum += item.age;
            });
            return sum;
        }
    }
</script>

<div ng-controller="DemoCtrl">

    <table ng-table="tableParams" class="table ng-table-responsive">
        <tbody ng-repeat="group in $groups">
        <tr class="ng-table-group">
            <td colspan="{{$columns.length}}">
                <a href="" ng-click="group.$hideRows = !group.$hideRows">
                    <span class="glyphicon" ng-class="{ 'glyphicon-chevron-right': group.$hideRows, 'glyphicon-chevron-down': !group.$hideRows }"></span>
                    <strong>{{ group.value }}</strong>
                </a>
            </td>
        </tr>
        <tr ng-hide="group.$hideRows" ng-repeat="user in group.data">
            <td sortable="'name'" data-title="'Name'">
                {{user.name}}
            </td>
            <td sortable="'age'" data-title="'Age'">
                {{user.age}}
            </td>
        </tr>
        <tr>
            <td class="text-success text-right"><strong>Summary:</strong></td>
            <td>{{calcSum(group.data)}}</td>
        </tr>
        </tbody>
    </table>

</div>